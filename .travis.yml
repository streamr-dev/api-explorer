language: node_js
node_js:
- '8'
sudo: true
branches:
  only:
  - master
  - "/^v\\d+\\.\\d+(\\.\\d+)?(-\\S*)?$/"
before_install:
- pip install awscli --upgrade --user
- rm -f ${TRAVIS_BUILD_DIR}/yarn.lock
- npm i -g npm@6.4.0
install:
- npm ci
- true
jobs:
  include:
  - stage: Api-Explorer Build Staging
    env:
    - NODE_ENV=production
    script:
    - npm install
    - npm run vendor:icons-bundle
    - npm run webpack:build
    deploy:
    - provider: s3
      access_key_id: AKIAI3FGPGMK3EREJJTQ
      secret_access_key:
        secure: lDYOQabCULKF1mDvYguA/mF9rZomlRTe7aTvXgienyjrp/gj8azjAi6Q+Z/UJiKtcDdWxtKGYBhUohbVSjN4VdGSdqhdHqf4yT9cgV0B0l1Yu4BYKSmy8HV+yLJ1NJ5vG9UM7EZd/CiwkjumBylnBjl+apZiMRtQa/XPT0QMO+adRG/W3AcceMLu73ItICUoaIbXy5Ti2MUWPEwf87IMSP/F/S9TFGEW5n3+bK5iT/fmjRHt2+4D7P2bE+zOXlpDmF4or2Q0SfROupbspGwSt2vow0Vxr7oAeyuDjbVvgaMvu9iUugFeGHPepWArnyjk5TZOvoCMqHKDIHPUdKu9OHTFu+CZOBbyXR1r3n71Rn2pPALHDUG58tmD7W9GUQSaCJtbyPgbQAlynyXa76gsut5dlF+LJfqB1ADb4Du6D1ZAk+fPZxbET72POdSAdDh9WqoWVsOPMMs7LxvLI0KoFxSJOdgxSarVx3Dl5R3QUg7yrAer3Z1gcGeIU1FzVbfpLAkY5sKljwr9ssCGvvrtPAoBp6ylmXY9usNNH+0obuwr7WURqgrborG5v/L4rjuihlf3GALVkf7X9qqiMHXJsd9wJ3rxLseAMbz6rhiNQYpDa/S16zwHraNM3OM0jHdNTWGQEgG+qSsuWhTDYuZNfakfHs2e7Pbsqe3Ou/KJ+hk=
      bucket: eu-west-1-stg-streamr-api-explorer
      local-dir: "$TRAVIS_BUILD_DIR/dist"
      acl: private
      region: eu-west-1
      skip_cleanup: true
      on:
        branch: master
  - stage: Api-Explorer Build Production
    if: NOT type IN (pull_request)
    env:
    - NODE_ENV=production
    script:
    - npm install
    - npm run vendor:icons-bundle
    - npm run webpack:build
